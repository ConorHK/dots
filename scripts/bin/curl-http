#!/bin/sh
set -euo pipefail
IFS=$'\n\t'

file="$1"
first_line="$(head -n 1 "$file")"
data_requests=("POST" "PATCH" "PUT")

request="$(echo "$first_line" | awk '{print $1;}')"
header="$(sed '2q;d' "$file")"
data="$(tail -n +4 "$file" | tr '\n' ' ')"
url="$(echo "$first_line" | awk '{print $2;}')"

if printf '%s\n' "${data_requests[@]}" | grep -Fxq "$request" ; then
    # POST, PATCH, PUT
    command="curl -s -X "$request" -H '"$header"' -d '"$data"' "$url""
else
    # GET, DELETE
    command="curl -s -X "$request" "$url""
fi

eval "$command | jq"
